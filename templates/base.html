{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{% block title %}FitMatrix{% endblock %}</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Sora:wght@400;500;600&display=swap" rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
    <link rel="stylesheet" href="{% static 'css/matrix.css' %}" />
    {% block extra_head %}{% endblock %}
  </head>
  <body>
    <div class="matrix-shell flex flex-col min-h-screen">
      <header class="fixed top-0 inset-x-0 z-50 px-4 sm:px-6 lg:px-10 pt-6 pb-4 mix-blend-normal">
        <div class="max-w-6xl mx-auto matrix-glass matrix-shadow px-5 sm:px-8 py-5 rounded-[30px] border border-transparent relative overflow-hidden flex items-center justify-between gap-6">
          <div class="absolute inset-0 pointer-events-none bg-gradient-to-br from-white/70 via-transparent to-[#d6ffd9]/70"></div>
          <a href="{% url 'home' %}" class="matrix-logo relative">
            <span class="matrix-chip" data-logo-chip>Fit</span>
            <span class="matrix-logo__name">Matrix</span>
          </a>
          <nav class="matrix-nav hidden lg:flex relative">
            {% url 'home' as home_url %}
            {% url 'search:results' as search_url %}
            {% url 'scheduling:sessions' as sessions_url %}
            {% url 'scheduling:booking-manage' as booking_manage_url %}
            {% url 'wishlist:list' as wishlist_url %}
            {% with match=request.resolver_match %}
              {% with url_name=match.url_name|default:'' %}
                <a href="{{ home_url }}" {% if request.path == home_url %}aria-current="page"{% endif %}>Home</a>
                <a href="{{ search_url }}" {% if match and match.app_name == 'search' %}aria-current="page"{% elif match and match.app_name == 'places' %}aria-current="page"{% endif %}>Explore</a>
                <a href="{{ sessions_url }}" {% if match and match.app_name == 'scheduling' and url_name|slice:':7' != 'booking' %}aria-current="page"{% endif %}>Sessions</a>
                {% if request.user.is_authenticated %}
                  <a href="{{ booking_manage_url }}" {% if match and match.app_name == 'scheduling' and url_name|slice:':7' == 'booking' %}aria-current="page"{% endif %}>Bookings</a>
                {% endif %}
                <a href="{{ wishlist_url }}" {% if match and match.url_name == 'list' %}aria-current="page"{% endif %}>Wishlist</a>
              {% endwith %}
              {% if request.user.is_authenticated and request.user.is_admin %}
                {% url 'accounts:admin-console' as admin_console_url %}
                {% with admin_url_name=match.url_name|default:'' %}

                {% with admin_pages=' admin-console admin-users admin-places admin-place-create admin-place-edit admin-trainers admin-trainer-create admin-trainer-edit admin-slots admin-slot-create admin-slot-edit admin-bookings admin-reviews ' %}
                <a
                  href="{{ admin_console_url }}"
                  {% if ' '|add:admin_url_name|add:' ' in admin_pages %}
                    aria-current="page"
                  {% endif %}
                >
                  Admin panel
                </a>
                  {% endwith %}
                 {% endwith %}
              {% endif %}
            {% endwith %}
            <a href="{{ search_url }}?type=studio" {% if request.GET.type == 'studio' %}aria-current="page"{% endif %}>Studios</a>
          </nav>
          <div class="hidden lg:flex items-center gap-3 relative">
            {% if request.user.is_authenticated %}
              <a href="{% url 'accounts:profile' %}" class="matrix-btn" data-variant="ghost">Profile</a>
            {% else %}
              <a href="{% url 'accounts:login' %}" class="matrix-btn" data-variant="ghost">Login</a>
            {% endif %}
            <a href="{% url 'search:results' %}" class="matrix-btn">Search</a>
          </div>
          <button type="button" class="lg:hidden matrix-btn relative" data-mobile-toggle data-variant="ghost" aria-label="Toggle navigation">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
        </div>
        <div class="lg:hidden max-w-6xl mx-auto" data-mobile-menu style="max-height: 0; overflow: hidden; transition: max-height 240ms ease;">
          <div class="matrix-glass mt-3 px-6 py-5 flex flex-col gap-4 rounded-[26px]">
            <a href="{% url 'home' %}">Home</a>
            <a href="{% url 'search:results' %}">Explore</a>
            <a href="{% url 'scheduling:sessions' %}">Sessions</a>
            {% if request.user.is_authenticated %}
              <a href="{% url 'scheduling:booking-manage' %}">Bookings</a>
            {% endif %}
            <a href="{% url 'wishlist:list' %}">Wishlist</a>
            {% if request.user.is_authenticated and request.user.is_admin %}
              <a href="{% url 'accounts:admin-console' %}">Admin panel</a>
            {% endif %}
            <a href="{% url 'search:results' %}?type=studio">Studios</a>
            {% if request.user.is_authenticated %}
              <a href="{% url 'accounts:profile' %}">Profile</a>
            {% else %}
              <a href="{% url 'accounts:login' %}">Login</a>
            {% endif %}
          </div>
        </div>
      </header>
      <main class="flex-1 w-full">
        <div class="pt-[120px] sm:pt-[140px] lg:pt-[160px]">
          {% block content %}{% endblock %}
        </div>
      </main>
      <footer class="matrix-footer">
        <div class="matrix-marquee w-full max-w-5xl">
          <div class="matrix-marquee__track">
            <span class="matrix-marquee__item">Performance / Recovery / Community</span>
            <span class="matrix-marquee__item">Matrix your movement</span>
            <span class="matrix-marquee__item">Performance / Recovery / Community</span>
            <span class="matrix-marquee__item">Matrix your movement</span>
          </div>
        </div>
        <p>FitMatrix - curated fitness ecosystems for Jakarta and beyond. &copy; {% now "Y" %}</p>
      </footer>
    </div>
    <div class="matrix-message-stack" role="status" aria-live="polite">
      {% for message in messages %}
        <div class="matrix-toast" data-toast data-tone="{% if 'error' in message.tags %}error{% elif 'info' in message.tags %}info{% else %}success{% endif %}">
          <span class="matrix-label">{{ message.tags|default:"info" }}</span>
          <span>{{ message }}</span>
          <button type="button" aria-label="Dismiss" data-toast-dismiss>&times;</button>
        </div>
      {% endfor %}
    </div>
    <script src="{% static 'js/matrix.js' %}"></script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
